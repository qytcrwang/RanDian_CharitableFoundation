<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="include :: header"></head>
<body>
<form class="layui-form" id="searchForm">
  <div class="layui-row">
    <div class="layui-col-md12" style="padding-top: 10px">
        活动类型：
        <div class="layui-inline" lay-filter="typeSelect">
	        <select name="activityType" id="activityType" lay-verify="">
			  <option value="">请选择</option>
			</select> 
        </div>
        活动状态：
        <div class="layui-inline" lay-filter="stateSelect">
	        <select name="activityState" id="activityState" lay-verify="">
			  <option value="">请选择</option>
			</select> 
        </div>
        开始时间：
        <div class="layui-inline">
          <input type="text" class="layui-input" name="activityStime" id="activityStime" placeholder="开始时间起始">
        </div>-
        <div class="layui-inline">
          <input type="text" class="layui-input" name="activityEtime" id="activityEtime" placeholder="开始时间截止">
        </div>
        <div class="layui-inline" style="float:right;">
	        <button type="button" class="layui-btn" data-type="reload" id="search">搜索</button>
	        <button type="button" class="layui-btn" data-type="reload" id="clear">重置</button>
      	</div>
    <div class="layui-col-md12" style="padding-top: 10px">
        	<div style="float:right;">
	        	<button type="button" class="layui-btn layui-btn-radius layui-btn-primary" data-type="reload" id="add">新增</button>
	        	<button type="button" class="layui-btn layui-btn-radius layui-btn-primary" data-type="reload" id="edit">编辑</button>
	        	<button type="button" class="layui-btn layui-btn-radius layui-btn-primary" data-type="reload" id="del">删除</button>
        	</div>
    </div>
    </div>
  </div>
</form>
  <table class="layui-hide" id="table" lay-filter="tableFilter"></table>
  <script type="text/javascript">
  layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element'], function(){
    var layer = layui.layer //弹层
        ,table = layui.table //表格
        ,element = layui.element; //元素操作
    //监听Tab切换
    element.on('tab(demo)', function(data){
      layer.msg('切换了：'+ this.innerHTML);
      console.log(data);
    });
    //执行一个 table 实例
    var tableIns = table.render({
      elem: '#table'
      ,url: 'back/activity/getList'
      ,method: 'post'
      ,contentType: 'application/json'
   	  ,parseData: function(res){ //res 即为原始返回的数据
   		    return {
   		      "code": res.status, //解析接口状态
   		      "msg": res.message, //解析提示文本
   		   	  "count": res.count, //解析数据长度
   		      "data": res.data //解析数据列表
   		    };
   	  }
    ,where: {field: 'activity_stime', sort: "desc"}
    ,response: {
        statusCode:1 //规定成功的状态码，默认：0
      }
      ,page: true //开启分页
      ,cols: [
          [
        {type:'checkbox'}
        ,{title: '序号', type:'numbers', align: 'center'}
        ,{field: 'id', hide:true, title:'id', align: 'center'}
        ,{field:'title', title: '活动标题', align: 'center'}
        ,{field:'type', title: '活动类型', align: 'center'}
        ,{field:'state', title: '活动状态', align: 'center'}
        ,{field:'activity_stime', title: '活动时间', align: 'center'}
        /* ,{fixed: 'right', width: 165, align:'center', toolbar: '#bar'} */
        ]
      ]
      ,id: 'tableReload'
    });

    var laydate = layui.laydate;
    
    //常规用法
    laydate.render({
      elem: '#activityStime'
    });
    laydate.render({
      elem: '#activityEtime'
    });
    
    layui.form.render('select','stateSelect');
    layui.form.render('select','typeSelect');
    
	$("#search").bind("click", function() {
		searchForm();
	});
    
	$("#clear").bind("click", function() {
		$("#searchForm").clearForm();
		searchForm();
	});
	
	var searchForm = function(){
		var table = layui.table;
		var type = $("#activityType").val();
		var state = $("#activityState").val();
		var stime = $("#activityStime").val();
		var etime = $("#activityEtime").val();
		if(stime!=""&&etime!=""){
			if(stime>etime){
				layer.msg('时间起始不可大于时间截止！');
				$("#activityEtime").val("");
				return;
			}
		}
		tableIns.reload({
		  where: {field: 'activity_stime', sort: "desc",
		    	type:type,stime:stime,
		    	state:state,etime:etime}
		,page: {
		    curr: 1 //重新从第 1 页开始
		  }
		});
	}
	
	  form.on('submit(formDemo)', function(data){
	    layer.msg(JSON.stringify(data.field));
	    return false;
	  });
  });
  
  $.ajax({
		type : "post",
		url : "back/activity/getSelect",
		async:false,
		data : "",
		dataType : 'json',
		error : function(XMLHttpRequest, textStatus, errorThrown) {
			console.log(XMLHttpRequest.status + "," + XMLHttpRequest.readyState + ","
					+ textStatus + "," + errorThrown);			
		},
		success : function(result) {
			var typeList = result['data']['typeList'];
			var stateList = result['data']['stateList'];
			var typeStr = "<option value=''>请选择</option>";
			var stateStr = "<option value=''>请选择</option>";
			for ( var i = 0; i < typeList.length; i++) {
				var data = typeList[i];
				typeStr += "<option value=" + data["code"] + ">" + data["value"]
						+ "</option>";
			}
			for ( var i = 0; i < stateList.length; i++) {
				var data = stateList[i];
				stateStr += "<option value=" + data["code"] + ">" + data["value"]
						+ "</option>";
			}
			$("#activityType").html(typeStr);
			$("#activityState").html(stateStr);
		    layui.form.render('select','stateSelect');
		    layui.form.render('select','typeSelect');
		}
	});
  
  </script>
</body>
