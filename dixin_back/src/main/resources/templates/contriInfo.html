<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="include :: header"></head>
<body>
  <div class="layui-row">
    <div class="layui-col-md8 layui-col-md-offset2">
      <div class="dTable" style="padding-top: 10px">
        <div class="layui-inline">
          <input class="layui-input" name="id" placeholder="会员Id" id="userIdReload" autocomplete="off">
        </div>
        <button class="layui-btn" data-type="reload">搜索</button>
      </div>
    </div>
  </div>
  <table class="layui-hide" id="contriInfoList" lay-filter="tableFilter"></table>
  <script type="text/javascript">
  layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element'], function(){
    var layer = layui.layer //弹层
        ,table = layui.table //表格
        ,element = layui.element; //元素操作
    //监听Tab切换
    element.on('tab(demo)', function(data){
      layer.msg('切换了：'+ this.innerHTML);
      console.log(data);
    });
    //执行一个 table 实例
    table.render({
      elem: '#contriInfoList'
      ,url: '/back/contriInfo/contriInfoList'
      ,method: 'post'
      ,contentType: 'application/json'
      ,page: true //开启分页
      ,parseData: function(res){ //res 即为原始返回的数据
        return {
          "code": res.status, //解析接口状态
          "msg": res.message, //解析提示文本
          "data": res.data //解析数据列表
        };
      }
      ,response: {
        statusCode:1 //规定成功的状态码，默认：0
      }
      ,cols: [
          [
        {type:'checkbox'}
        ,{title: '序号', type:'numbers', align: 'center'}
        ,{field:'contriAmount', title: 'contriAmount', align: 'center'}
        ,{field:'contriThings', title: 'contriThings', align: 'center'}
        ,{field:'contriTime', title: 'contriTime', align: 'center'}
        ,{field:'mobile', title: 'mobile', align: 'center'}
        ,{fixed: 'right', width: 165, align:'center', toolbar: '#bar'}
        ]
      ]
      ,id: 'tableReload'
    });

    //监听工具条
    table.on('tool(tableFilter)', function(obj){
      var data = obj.data //获得当前行数据
          ,layEvent = obj.event; //获得 lay-event 对应的值
      if(layEvent === 'detail'){
        // layer.msg('查看操作');
        var userId = data.id;
        var jsonData;
        $.ajax({
          type:"get",
          url:"/back/contriInfo/getContriInfoDetail",
          dataType:"json",
          data:{"contriInfoId":userId},
          success : function(data){
            jsonData = data.data;
          }
        });
        layer.open({
          type: 2
          ,offset: '0px'
          ,scrollbar: false
          ,title: '捐赠详情'
          ,skin: 'layui-layer-molv'
          ,area: ['1000px', '450px']
          ,content: ['/contriInfoDetail','false']
          ,success: function(layero,index){
            console.log(layero, index);
            var name = $("#nameIndex", layero.find("iframe")[0].contentWindow.document);
            name.val(jsonData.contriAmount);
          }
        });
      } else if(layEvent === 'edit'){
        layer.msg('查看操作');
        layer.confirm('纳尼？', {
          btn: ['按钮一', '按钮二', '按钮三'] //可以无限个按钮
          ,btn3: function(index, layero){
            //按钮【按钮三】的回调
          }
        }, function(index, layero){
          //按钮【按钮一】的回调
        }, function(index){
          //按钮【按钮二】的回调
        });
      }
    });

    var $ = layui.$, active = {
      reload: function(){
        var userIdReload = $('#userIdReload');
        //执行重载
        table.reload('tableReload', {
          page: {
            curr: 1 //重新从第 1 页开始
          }
          ,where: {
            userId: userId.val()
          }
        });
      }
    };

    $('.dTable .layui-btn').on('click', function(){
      var type = $(this).data('type');
      active[type] ? active[type].call(this) : '';
    });
  });
  </script>
  <script type="text/html" id="bar">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">审核</a>
  </script>
</body>
